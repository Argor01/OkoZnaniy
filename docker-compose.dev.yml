services:
  # Переопределяем frontend для development
  frontend:
    build:
      context: ./frontend-react
      dockerfile: Dockerfile.dev
    volumes:
      - ./frontend-react:/app
      - /app/node_modules
    environment:
      - CHOKIDAR_USEPOLLING=true
      - FAST_REFRESH=true
      - WDS_SOCKET_HOST=localhost
      - WDS_SOCKET_PORT=5173
    ports:
      - "5173:5173"
    depends_on:
      - backend
    networks:
      - app_network
    
  backend:
    volumes:
      - .:/app
    environment:
      - DEBUG=True
      - DJANGO_ENV=development
      - DATABASE_URL=postgresql://postgres:${POSTGRES_PASSWORD}@postgres:5432/oko_db
      - REDIS_URL=redis://redis:6379/0
      - CELERY_BROKER_URL=redis://redis:6379/0
      - CELERY_RESULT_BACKEND=redis://redis:6379/0
      - CHANNEL_REDIS_URL=redis://redis:6379/0
    command: python manage.py runserver 0.0.0.0:8000
    
  # Отключаем nginx для разработки
  nginx:
    profiles:
      - production
  
  # Отключаем telegram-bot для разработки
  telegram-bot:
    profiles:
      - production

networks:
  app_network:
    driver: bridge
