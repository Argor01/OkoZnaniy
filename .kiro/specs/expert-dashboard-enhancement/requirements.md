# Requirements Document

## Introduction

Данный документ описывает требования к доработке личного кабинета эксперта для платформы заказа учебных работ OkoZnaniy. Личный кабинет должен предоставлять экспертам полный набор инструментов для управления профилем, заказами, финансами и взаимодействия с клиентами.

## Glossary

- **Expert Dashboard** - Личный кабинет эксперта, веб-интерфейс для управления профилем и работой
- **Backend API** - Серверная часть приложения на Django REST Framework
- **Expert** - Пользователь с ролью 'expert', выполняющий заказы
- **Order** - Заказ на выполнение учебной работы
- **Specialization** - Специализация эксперта в определенном предмете
- **Transaction** - Финансовая транзакция (пополнение, вывод, оплата)
- **ExpertStatistics** - Модель статистики эксперта
- **ExpertApplication** - Анкета эксперта для регистрации
- **ExpertReview** - Отзыв клиента о работе эксперта
- **Notification** - Уведомление для пользователя

## Requirements

### Requirement 1

**User Story:** Как эксперт, я хочу видеть полную статистику моей работы на главной странице личного кабинета, чтобы отслеживать свою эффективность и доходы

#### Acceptance Criteria

1. WHEN эксперт открывает главную страницу личного кабинета, THE Backend API SHALL возвращать агрегированную статистику включающую общий заработок, заработок за текущий месяц, количество активных заказов, количество завершенных заказов, средний рейтинг и процент успешных заказов
2. WHEN эксперт запрашивает статистику, THE Backend API SHALL вычислять данные на основе моделей Transaction, Order, ExpertReview и ExpertStatistics
3. THE Backend API SHALL обновлять статистику в реальном времени при изменении связанных данных
4. THE Backend API SHALL возвращать статистику только для аутентифицированного эксперта
5. IF эксперт не имеет записи ExpertStatistics, THEN THE Backend API SHALL создавать её автоматически при первом запросе

### Requirement 2

**User Story:** Как эксперт, я хочу управлять своим профилем и специализациями, чтобы клиенты могли видеть мою квалификацию

#### Acceptance Criteria

1. WHEN эксперт запрашивает свой профиль, THE Backend API SHALL возвращать данные пользователя, список специализаций, загруженные документы и последние отзывы
2. THE Backend API SHALL позволять эксперту обновлять поля профиля включая bio, avatar, education, skills, portfolio_url
3. THE Backend API SHALL позволять эксперту добавлять новые специализации с указанием предмета, опыта работы, почасовой ставки и описания
4. THE Backend API SHALL позволять эксперту загружать документы подтверждающие квалификацию с типами diploma, certificate, award, other
5. WHEN эксперт обновляет профиль, THE Backend API SHALL валидировать данные и возвращать ошибки при некорректном вводе

### Requirement 3

**User Story:** Как эксперт, я хочу видеть список доступных заказов по моим специализациям, чтобы выбирать подходящие для работы

#### Acceptance Criteria

1. WHEN эксперт запрашивает доступные заказы, THE Backend API SHALL возвращать заказы со статусом new, без назначенного эксперта и соответствующие специализациям эксперта
2. THE Backend API SHALL фильтровать заказы по верифицированным специализациям эксперта
3. THE Backend API SHALL включать в ответ информацию о заказе включающую title, description, budget, deadline, subject, work_type, complexity и данные клиента
4. THE Backend API SHALL сортировать заказы по дате создания от новых к старым
5. WHEN эксперт берет заказ в работу, THE Backend API SHALL проверять наличие верифицированной специализации по предмету заказа

### Requirement 4

**User Story:** Как эксперт, я хочу видеть список моих активных заказов, чтобы отслеживать текущую работу

#### Acceptance Criteria

1. WHEN эксперт запрашивает активные заказы, THE Backend API SHALL возвращать заказы со статусами in_progress, review, revision назначенные данному эксперту
2. THE Backend API SHALL включать в ответ полную информацию о заказе и клиенте
3. THE Backend API SHALL использовать select_related для оптимизации запросов к связанным моделям
4. THE Backend API SHALL сортировать заказы по дате создания от новых к старым
5. THE Backend API SHALL возвращать пустой список если у эксперта нет активных заказов

### Requirement 5

**User Story:** Как эксперт, я хочу видеть историю моих заказов, чтобы анализировать выполненную работу

#### Acceptance Criteria

1. WHEN эксперт запрашивает историю заказов, THE Backend API SHALL возвращать последние десять заказов эксперта независимо от статуса
2. THE Backend API SHALL включать в ответ краткую информацию о заказе включающую id, title, status, budget, created_at, client и subject
3. THE Backend API SHALL использовать пагинацию для больших списков заказов
4. THE Backend API SHALL сортировать заказы по дате создания от новых к старым
5. THE Backend API SHALL возвращать только заказы назначенные данному эксперту

### Requirement 6

**User Story:** Как эксперт, я хочу брать доступные заказы в работу, чтобы начать их выполнение

#### Acceptance Criteria

1. WHEN эксперт отправляет запрос на взятие заказа, THE Backend API SHALL проверять что заказ имеет статус new и не назначен другому эксперту
2. IF у эксперта есть верифицированная специализация по предмету заказа, THEN THE Backend API SHALL назначать эксперта на заказ и изменять статус на in_progress
3. IF у эксперта нет верифицированной специализации, THEN THE Backend API SHALL возвращать ошибку с кодом 403
4. WHEN заказ успешно взят, THE Backend API SHALL отправлять уведомление клиенту через NotificationService
5. THE Backend API SHALL возвращать подтверждение с id заказа при успешном взятии

### Requirement 7

**User Story:** Как эксперт, я хочу видеть свой баланс и историю транзакций, чтобы контролировать финансы

#### Acceptance Criteria

1. WHEN эксперт запрашивает финансовую информацию, THE Backend API SHALL возвращать текущий баланс, замороженный баланс и список последних транзакций
2. THE Backend API SHALL включать в список транзакций тип операции, сумму, дату и статус
3. THE Backend API SHALL фильтровать транзакции по типу payout, payment, refund
4. THE Backend API SHALL поддерживать фильтрацию транзакций по дате и типу через query параметры
5. THE Backend API SHALL использовать пагинацию для списка транзакций

### Requirement 8

**User Story:** Как эксперт, я хочу видеть отзывы клиентов о моей работе, чтобы понимать качество услуг

#### Acceptance Criteria

1. WHEN эксперт запрашивает отзывы, THE Backend API SHALL возвращать опубликованные отзывы с рейтингом, комментарием, датой и информацией о клиенте и заказе
2. THE Backend API SHALL сортировать отзывы по дате создания от новых к старым
3. THE Backend API SHALL включать только отзывы с флагом is_published равным true
4. THE Backend API SHALL использовать select_related для оптимизации запросов
5. THE Backend API SHALL поддерживать пагинацию для списка отзывов

### Requirement 9

**User Story:** Как эксперт, я хочу получать уведомления о новых заказах и событиях, чтобы оперативно реагировать

#### Acceptance Criteria

1. WHEN происходит событие требующее уведомления эксперта, THE Backend API SHALL создавать запись уведомления в модели Notification
2. THE Backend API SHALL поддерживать типы уведомлений new_order, order_assigned, review_received, document_verified, specialization_verified
3. WHEN эксперт запрашивает уведомления, THE Backend API SHALL возвращать непрочитанные уведомления отсортированные по дате
4. THE Backend API SHALL позволять эксперту отмечать уведомления как прочитанные
5. THE Backend API SHALL возвращать счетчик непрочитанных уведомлений

### Requirement 10

**User Story:** Как эксперт, я хочу управлять своей анкетой, чтобы администраторы могли проверить мою квалификацию

#### Acceptance Criteria

1. WHEN эксперт создает анкету, THE Backend API SHALL сохранять данные включающие full_name, work_experience_years, specializations и список образований
2. THE Backend API SHALL проверять что у эксперта нет существующей анкеты перед созданием новой
3. THE Backend API SHALL устанавливать статус анкеты в pending при создании
4. WHEN эксперт запрашивает свою анкету, THE Backend API SHALL возвращать данные анкеты включая статус, дату рассмотрения и причину отклонения если применимо
5. THE Backend API SHALL позволять эксперту обновлять анкету только если она имеет статус rejected
