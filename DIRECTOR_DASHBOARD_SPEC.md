# Техническое задание: Личный кабинет директора

## 1. Общая информация

### 1.1 Назначение
Личный кабинет директора предназначен для управления персоналом, мониторинга финансовых показателей компании и анализа работы партнёрской сети.

### 1.2 Целевая аудитория
- Директор компании
- Главный администратор системы

### 1.3 Доступ
- Доступ только для пользователей с ролью `director` (определяется по email `director@test.com`)
- Авторизация через форму входа в админ-панели
- После входа - редирект на `/director`

---

## 2. Функциональные требования

### 2.1 Управление персоналом

#### 2.1.1 Приём сотрудников на работу

**Описание:**
Директор может принимать новых сотрудников на работу через систему регистрации, утверждения анкет и назначения ролей.

**Функционал:**
- **Регистрация сотрудников**
  - Создание новой учётной записи сотрудника
  - Поля формы регистрации:
    - Email (обязательно)
    - Имя (обязательно)
    - Фамилия (обязательно)
    - Телефон (опционально)
    - Роль (выбор из списка: admin, arbitrator, partner, expert)
    - Пароль (автогенерация или ручной ввод)
  
- **Утверждение анкет экспертов**
  - Просмотр поданных анкет экспертов
  - Поля анкеты:
    - Личные данные (имя, фамилия, email, телефон)
    - Опыт работы (количество лет)
    - Образование
    - Навыки
    - Портфолио (ссылка)
    - Биография
    - Специализации
  - Действия:
    - Утвердить анкету (кнопка "Утвердить")
    - Отклонить анкету (кнопка "Отклонить" с возможностью указать причину)
    - Отправить на доработку (кнопка "На доработку" с комментарием)
  
- **Назначение ролей**
  - Назначение роли при регистрации нового сотрудника
  - Изменение роли существующего сотрудника
  - Доступные роли:
    - `admin` - Администратор
    - `arbitrator` - Арбитр
    - `partner` - Партнёр
    - `expert` - Эксперт
    - `client` - Клиент (для внутренних сотрудников не используется)

**Элементы интерфейса:**
- Раздел "Управление персоналом"
- Вкладка "Новые сотрудники"
- Вкладка "Анкеты экспертов"
- Форма регистрации сотрудника
- Таблица со списком анкет экспертов
- Модальные окна для утверждения/отклонения анкет

#### 2.1.2 Увольнение сотрудников

**Описание:**
Директор может уволить сотрудника, отключив ему доступ к системе и заархивировав его анкету.

**Функционал:**
- **Отключение доступа**
  - Блокировка учётной записи сотрудника
  - Действия:
    - Деактивация аккаунта (кнопка "Деактивировать")
    - Блокировка входа в систему
    - Сохранение всех данных пользователя
    - Возможность восстановления доступа (кнопка "Восстановить доступ")
  
- **Архивация анкет**
  - Перемещение анкеты в архив
  - Действия:
    - Архивировать анкету (кнопка "Архивировать")
    - Просмотр архивированных анкет (раздел "Архив")
    - Восстановление из архива (кнопка "Восстановить")
    - Удаление из архива (кнопка "Удалить навсегда")

**Элементы интерфейса:**
- Вкладка "Активные сотрудники"
- Вкладка "Архив"
- Таблица со списком сотрудников
- Кнопки действий для каждого сотрудника
- Модальное окно подтверждения увольнения

---

### 2.2 Финансовая статистика

#### 2.2.1 Общий оборот за месяц

**Описание:**
Отображение общего оборота компании за текущий месяц (с 1-го числа текущего месяца по 1-е число следующего месяца).

**Функционал:**
- **Расчёт оборота**
  - Сумма всех заказов за период
  - Включает:
    - Оплаченные заказы
    - Заказы в работе
    - Завершённые заказы
  - Исключает:
    - Отменённые заказы
    - Возвращённые средства
  
- **Визуализация**
  - Карточка с общей суммой оборота
  - График оборота по дням/неделям
  - Сравнение с предыдущим месяцем (в процентах и абсолютных значениях)
  - Индикатор роста/падения

**Элементы интерфейса:**
- Карточка "Общий оборот за месяц"
- График оборота (линейный график)
- Индикаторы изменения

#### 2.2.2 Чистая прибыль компании

**Описание:**
Расчёт и отображение чистой прибыли компании за выбранный период.

**Функционал:**
- **Выбор периода**
  - Календарь для выбора дат
  - Предустановленные периоды:
    - Сегодня
    - Вчера
    - Эта неделя
    - Этот месяц
    - Прошлый месяц
    - Этот квартал
    - Прошлый квартал
    - Этот год
    - Прошлый год
    - Произвольный период
  
- **Расчёт чистой прибыли**
  - Формула: `Чистая прибыль = Доходы - Расходы`
  - Доходы:
    - Выручка от заказов
    - Комиссии от партнёров
    - Дополнительные доходы
  - Расходы:
    - Выплаты экспертам
    - Выплаты партнёрам
    - Операционные расходы
    - Налоги
    - Другие расходы
  
- **Визуализация**
  - Карточка с чистой прибылью
  - График прибыли за период
  - Разбивка по статьям доходов и расходов
  - Процентное соотношение доходов и расходов

**Элементы интерфейса:**
- Селектор периода
- Карточка "Чистая прибыль"
- График прибыли
- Круговая диаграмма доходов/расходов

#### 2.2.3 Детализация доходов и расходов

**Описание:**
Подробная детализация всех доходов и расходов компании за выбранный период.

**Функционал:**
- **Детализация доходов**
  - Выручка от заказов:
    - Количество заказов
    - Сумма по каждому заказу
    - Средний чек
    - По категориям работ
  - Комиссии от партнёров:
    - Список партнёров
    - Сумма комиссии от каждого партнёра
    - Количество привлечённых клиентов
  - Дополнительные доходы:
    - Прочие поступления
    - Возвраты комиссий
  
- **Детализация расходов**
  - Выплаты экспертам:
    - Список экспертов
    - Сумма выплат каждому эксперту
    - Количество выполненных заказов
  - Выплаты партнёрам:
    - Список партнёров
    - Сумма выплат каждому партнёру
    - Процент комиссии
  - Операционные расходы:
    - Затраты на обслуживание
    - Маркетинг
    - Поддержка клиентов
  - Налоги:
    - НДС
    - Подоходный налог
    - Другие налоги
  
- **Экспорт данных**
  - Экспорт в Excel (.xlsx)
  - Экспорт в CSV
  - Экспорт в PDF (отчёт)

**Элементы интерфейса:**
- Вкладка "Доходы"
- Вкладка "Расходы"
- Таблицы с детализацией
- Кнопки экспорта
- Фильтры по категориям

---

### 2.3 Панель навигации

#### 2.3.1 Список партнёров

**Описание:**
Отображение списка всех активных партнёров с общей информацией о каждом.

**Функционал:**
- **Общее количество активных партнёров**
  - Счётчик активных партнёров
  - Фильтрация:
    - Все партнёры
    - Только активные
    - Только неактивные
    - По дате регистрации
    - По количеству рефералов
  
- **Информация о партнёрах**
  - Данные партнёра:
    - Имя и фамилия
    - Email
    - Телефон
    - Дата регистрации
    - Реферальный код
    - Процент комиссии
    - Общее количество рефералов
    - Количество активных рефералов
    - Общий доход партнёра
    - Статус (активен/неактивен)
  
- **Действия с партнёрами**
  - Просмотр детальной информации
  - Изменение процента комиссии
  - Деактивация/активация партнёра
  - Просмотр списка рефералов

**Элементы интерфейса:**
- Карточка "Активные партнёры" (счётчик)
- Таблица со списком партнёров
- Фильтры и поиск
- Кнопки действий

#### 2.3.2 Оборот по партнёрам

**Описание:**
Показ ежемесячного оборота, который приносит каждый партнёр (с 1-го по 1-е число каждого месяца).

**Функционал:**
- **Расчёт оборота по партнёрам**
  - Ежемесячный оборот для каждого партнёра
  - Период: с 1-го числа текущего месяца по 1-е число следующего месяца
  - Учёт:
    - Заказы, сделанные рефералами партнёра
    - Сумма заказов
    - Комиссия партнёра
    - Количество активных рефералов
  
- **Визуализация**
  - Таблица с оборотами по партнёрам
  - График оборота по месяцам
  - Топ партнёров по обороту
  - Сравнение партнёров
  
- **Фильтрация и сортировка**
  - По периоду (месяц, квартал, год)
  - По сумме оборота
  - По количеству рефералов
  - По проценту комиссии

**Элементы интерфейса:**
- Таблица "Оборот по партнёрам"
- График оборота
- Селектор периода
- Фильтры и сортировка
- Экспорт данных

---

### 2.4 Общая статистика

#### 2.4.1 Сводка по всем финансовым показателям

**Описание:**
Общая сводка по всем финансовым показателям компании с возможностью быстрого анализа.

**Функционал:**
- **Ключевые показатели (KPI)**
  - Общий оборот за период
  - Чистая прибыль
  - Количество активных заказов
  - Средний чек
  - Количество клиентов
  - Количество экспертов
  - Количество партнёров
  - Конверсия
  
- **Визуализация**
  - Дашборд с карточками показателей
  - Графики трендов
  - Сравнение периодов
  - Индикаторы роста/падения
  
- **Детализация**
  - Возможность перехода к детальной информации по каждому показателю
  - Фильтры по периоду
  - Экспорт отчёта

**Элементы интерфейса:**
- Дашборд с карточками KPI
- Графики и диаграммы
- Селектор периода
- Кнопки перехода к детализации
- Кнопка экспорта отчёта

---

## 3. Технические требования

### 3.1 Frontend

#### 3.1.1 Технологии
- React 19+
- TypeScript
- Ant Design 5+
- React Query (TanStack Query) для управления состоянием
- React Router DOM для маршрутизации
- Chart.js или Recharts для графиков
- Day.js для работы с датами

#### 3.1.2 Структура компонентов
```
src/pages/DirectorDashboard/
  ├── DirectorDashboard.tsx (главный компонент)
  ├── components/
  │   ├── PersonnelManagement/
  │   │   ├── PersonnelManagement.tsx
  │   │   ├── EmployeeRegistration.tsx
  │   │   ├── ExpertApplications.tsx
  │   │   ├── EmployeeList.tsx
  │   │   └── EmployeeArchive.tsx
  │   ├── FinancialStatistics/
  │   │   ├── FinancialStatistics.tsx
  │   │   ├── MonthlyTurnover.tsx
  │   │   ├── NetProfit.tsx
  │   │   └── IncomeExpenseDetail.tsx
  │   ├── PartnerPanel/
  │   │   ├── PartnerPanel.tsx
  │   │   ├── PartnerList.tsx
  │   │   └── PartnerTurnover.tsx
  │   └── GeneralStatistics/
  │       ├── GeneralStatistics.tsx
  │       └── KPICards.tsx
  └── api/
      ├── directorApi.ts
      └── types.ts
```

#### 3.1.3 API Endpoints

**Управление персоналом:**
- `GET /api/director/personnel/` - Список всех сотрудников
- `POST /api/director/personnel/register/` - Регистрация нового сотрудника
- `GET /api/director/personnel/expert-applications/` - Список анкет экспертов
- `POST /api/director/personnel/expert-applications/{id}/approve/` - Утвердить анкету
- `POST /api/director/personnel/expert-applications/{id}/reject/` - Отклонить анкету
- `POST /api/director/personnel/{id}/deactivate/` - Деактивировать сотрудника
- `POST /api/director/personnel/{id}/activate/` - Активировать сотрудника
- `POST /api/director/personnel/{id}/archive/` - Архивировать анкету
- `GET /api/director/personnel/archive/` - Список архивированных анкет

**Финансовая статистика:**
- `GET /api/director/finance/turnover/` - Общий оборот за период
- `GET /api/director/finance/net-profit/` - Чистая прибыль за период
- `GET /api/director/finance/income/` - Детализация доходов
- `GET /api/director/finance/expense/` - Детализация расходов
- `GET /api/director/finance/export/` - Экспорт финансовых данных

**Панель партнёров:**
- `GET /api/director/partners/` - Список партнёров
- `GET /api/director/partners/{id}/turnover/` - Оборот партнёра за период
- `GET /api/director/partners/turnover/` - Оборот по всем партнёрам

**Общая статистика:**
- `GET /api/director/statistics/kpi/` - Ключевые показатели
- `GET /api/director/statistics/summary/` - Общая сводка

### 3.2 Backend

#### 3.2.1 Технологии
- Django 4+
- Django REST Framework
- PostgreSQL
- Celery (для фоновых задач)

#### 3.2.2 Модели данных

**Персонал:**
- Модель `Employee` (расширение модели `User`)
- Модель `ExpertApplication` (уже существует)
- Модель `EmployeeArchive`

**Финансы:**
- Модель `FinancialTransaction`
- Модель `Income`
- Модель `Expense`
- Модель `MonthlyReport`

**Партнёры:**
- Модель `Partner` (уже существует как `User` с ролью `partner`)
- Модель `PartnerTurnover`

#### 3.2.3 Права доступа
- Только пользователи с ролью `director` (email `director@test.com`)
- Использование Django permissions
- Кастомный permission класс `IsDirector`

### 3.3 База данных

#### 3.3.1 Новые таблицы
- `director_employee_archive` - Архив сотрудников
- `director_financial_transaction` - Финансовые транзакции
- `director_income` - Доходы
- `director_expense` - Расходы
- `director_monthly_report` - Ежемесячные отчёты
- `director_partner_turnover` - Оборот по партнёрам

---

## 4. Дизайн и UX

### 4.1 Общий стиль
- Минималистичный дизайн
- Использование корпоративных цветов
- Адаптивная вёрстка (desktop, tablet, mobile)
- Тёмная/светлая тема (опционально)

### 4.2 Навигация
- Боковое меню с разделами:
  - Управление персоналом
  - Финансовая статистика
  - Панель партнёров
  - Общая статистика
- Хлебные крошки
- Кнопка выхода

### 4.3 Компоненты
- Карточки для KPI
- Таблицы с пагинацией и сортировкой
- Графики и диаграммы
- Модальные окна для действий
- Формы с валидацией
- Уведомления (toast messages)

---

## 5. Этапы разработки

### Этап 1: Базовая структура и настройка проекта (1 день)

#### 1.1 Создание структуры компонентов (2 часа)
**Задачи:**
- Создать директорию `src/pages/DirectorDashboard/`
- Создать поддиректории:
  - `components/PersonnelManagement/`
  - `components/FinancialStatistics/`
  - `components/PartnerPanel/`
  - `components/GeneralStatistics/`
  - `api/`
- Создать базовые файлы компонентов (пустые заготовки):
  - `DirectorDashboard.tsx` - главный компонент
  - `components/PersonnelManagement/PersonnelManagement.tsx`
  - `components/FinancialStatistics/FinancialStatistics.tsx`
  - `components/PartnerPanel/PartnerPanel.tsx`
  - `components/GeneralStatistics/GeneralStatistics.tsx`
- Создать файлы для API:
  - `api/directorApi.ts` - функции для API запросов
  - `api/types.ts` - TypeScript типы и интерфейсы

**Результат:**
- Структура файлов создана
- Все базовые компоненты импортированы и экспортированы
- Нет ошибок компиляции

#### 1.2 Настройка роутинга (30 минут)
**Задачи:**
- Проверить, что роут `/director` уже добавлен в `App.tsx`
- Убедиться, что `DirectorDashboard` обёрнут в `ProtectedRoute`
- Проверить редирект после входа директора на `/director`
- Убедиться, что неавторизованные пользователи не могут попасть на страницу

**Результат:**
- Роутинг работает корректно
- Защита маршрута функционирует

#### 1.3 Базовый layout с навигацией (3 часа)
**Задачи:**
- Создать основной layout для `DirectorDashboard`:
  - Шапка с заголовком "Личный кабинет директора"
  - Боковое меню (Sider) с разделами:
    - Управление персоналом
    - Финансовая статистика
    - Панель партнёров
    - Общая статистика
  - Область контента (Content)
  - Футер с кнопкой выхода
- Реализовать переключение между разделами через состояние (useState)
- Добавить активное состояние для пунктов меню
- Стилизовать layout в соответствии с дизайн-системой проекта
- Добавить иконки для пунктов меню из Ant Design Icons

**Результат:**
- Базовый layout отображается
- Навигация между разделами работает
- Кнопка выхода функционирует (редирект на `/admin`)

#### 1.4 API endpoints (заглушки) (2.5 часа)
**Задачи:**
- Создать файл `api/directorApi.ts`
- Определить все необходимые функции для API запросов:
  - Управление персоналом:
    - `getPersonnel()` - получить список сотрудников
    - `registerEmployee(data)` - зарегистрировать сотрудника
    - `getExpertApplications()` - получить список анкет экспертов
    - `approveApplication(id)` - утвердить анкету
    - `rejectApplication(id, reason)` - отклонить анкету
    - `deactivateEmployee(id)` - деактивировать сотрудника
    - `activateEmployee(id)` - активировать сотрудника
    - `archiveEmployee(id)` - архивировать сотрудника
    - `getArchivedEmployees()` - получить архив сотрудников
  - Финансовая статистика:
    - `getMonthlyTurnover(period)` - получить оборот за период
    - `getNetProfit(period)` - получить чистую прибыль
    - `getIncomeDetail(period)` - детализация доходов
    - `getExpenseDetail(period)` - детализация расходов
    - `exportFinancialData(period, format)` - экспорт данных
  - Панель партнёров:
    - `getPartners()` - получить список партнёров
    - `getPartnerTurnover(partnerId, period)` - оборот партнёра
    - `getAllPartnersTurnover(period)` - оборот всех партнёров
  - Общая статистика:
    - `getKPI(period)` - ключевые показатели
    - `getStatisticsSummary(period)` - общая сводка
- Все функции должны возвращать Promise с типами данных
- Добавить обработку ошибок (try/catch)
- Использовать `apiClient` из `api/client.ts` для запросов

**Результат:**
- Все API функции определены
- Типы данных указаны
- Функции готовы к интеграции с бэкендом

---

### Этап 2: Управление персоналом (1.5 дня)

#### 2.1 Компонент управления персоналом (2 часа)
**Задачи:**
- Создать компонент `PersonnelManagement.tsx`
- Реализовать вкладки (Tabs):
  - "Новые сотрудники" - для регистрации
  - "Анкеты экспертов" - для утверждения анкет
  - "Активные сотрудники" - список сотрудников
  - "Архив" - архивированные сотрудники
- Добавить состояние для активной вкладки
- Реализовать переключение между вкладками

**Результат:**
- Компонент отображается в разделе "Управление персоналом"
- Вкладки переключаются
- Структура компонента готова для заполнения функционалом

#### 2.2 Регистрация сотрудников (3 часа)
**Задачи:**
- Создать компонент `EmployeeRegistration.tsx`
- Реализовать форму регистрации с полями:
  - Email (input, валидация email)
  - Имя (input, обязательное)
  - Фамилия (input, обязательное)
  - Телефон (input, опционально)
  - Роль (Select с вариантами: admin, arbitrator, partner, expert)
  - Пароль (Password input с опцией автогенерации)
- Добавить валидацию формы:
  - Email должен быть корректным
  - Имя и фамилия обязательны
  - Роль обязательна
  - Пароль минимум 6 символов (или автогенерация)
- Добавить кнопку "Сгенерировать пароль" для автогенерации
- Добавить кнопку "Зарегистрировать" для отправки формы
- При отправке формы:
  - Вызвать `directorApi.registerEmployee(data)`
  - Показать сообщение об успехе/ошибке
  - Очистить форму после успешной регистрации
  - Обновить список сотрудников (если отображается)

**Результат:**
- Форма регистрации работает
- Валидация функционирует
- Новый сотрудник создаётся через API
- Обработка ошибок реализована

#### 2.3 Утверждение анкет экспертов (3 часа)
**Задачи:**
- Создать компонент `ExpertApplications.tsx`
- Реализовать таблицу со списком анкет экспертов:
  - Колонки:
    - Имя и фамилия
    - Email
    - Дата подачи анкеты
    - Статус (новая, на рассмотрении, одобрена, отклонена)
    - Действия
  - Добавить пагинацию
  - Добавить фильтры по статусу
  - Добавить поиск по имени/email
- Реализовать модальное окно для просмотра деталей анкеты:
  - Отображение всех полей анкеты
  - Кнопки действий:
    - "Утвердить" - вызывает `directorApi.approveApplication(id)`
    - "Отклонить" - открывает форму с полем "Причина отклонения", затем вызывает `directorApi.rejectApplication(id, reason)`
    - "На доработку" - открывает форму с полем "Комментарий", отправляет комментарий
    - "Закрыть" - закрывает модальное окно
- При утверждении/отклонении:
  - Показать сообщение об успехе
  - Обновить список анкет
  - Закрыть модальное окно

**Результат:**
- Список анкет отображается
- Детали анкеты просматриваются
- Анкеты утверждаются/отклоняются
- Статусы обновляются корректно

#### 2.4 Список активных сотрудников (2 часа)
**Задачи:**
- Создать компонент `EmployeeList.tsx`
- Реализовать таблицу со списком сотрудников:
  - Колонки:
    - Имя и фамилия
    - Email
    - Роль
    - Дата регистрации
    - Статус (активен/неактивен)
    - Действия
  - Добавить пагинацию
  - Добавить фильтры:
    - По роли
    - По статусу
  - Добавить поиск по имени/email
- Реализовать действия для каждого сотрудника:
  - "Деактивировать" - вызывает `directorApi.deactivateEmployee(id)`, показывает модальное окно подтверждения
  - "Активировать" - вызывает `directorApi.activateEmployee(id)` (если сотрудник деактивирован)
  - "Архивировать" - вызывает `directorApi.archiveEmployee(id)`, показывает модальное окно подтверждения
  - "Просмотр" - открывает модальное окно с детальной информацией о сотруднике
- При деактивации/архивации:
  - Показать сообщение об успехе
  - Обновить список сотрудников
  - Обновить статус в таблице

**Результат:**
- Список сотрудников отображается
- Фильтры и поиск работают
- Действия выполняются корректно
- Статусы обновляются

#### 2.5 Архив сотрудников (2 часа)
**Задачи:**
- Создать компонент `EmployeeArchive.tsx`
- Реализовать таблицу с архивированными сотрудниками:
  - Колонки:
    - Имя и фамилия
    - Email
    - Роль
    - Дата архивации
    - Действия
  - Добавить пагинацию
  - Добавить поиск
- Реализовать действия:
  - "Восстановить" - вызывает функцию восстановления из архива, показывает модальное окно подтверждения
  - "Удалить навсегда" - вызывает функцию удаления, показывает модальное окно подтверждения с предупреждением
  - "Просмотр" - открывает модальное окно с информацией о сотруднике
- При восстановлении/удалении:
  - Показать сообщение об успехе
  - Обновить список архива
  - Обновить список активных сотрудников (при восстановлении)

**Результат:**
- Архив отображается
- Восстановление работает
- Удаление работает с подтверждением

---

### Этап 3: Финансовая статистика (1.5 дня)

#### 3.1 Компонент финансовой статистики (1 час)
**Задачи:**
- Создать компонент `FinancialStatistics.tsx`
- Реализовать вкладки:
  - "Общий оборот" - оборот за месяц
  - "Чистая прибыль" - прибыль за период
  - "Доходы и расходы" - детализация
- Добавить состояние для активной вкладки
- Реализовать переключение между вкладками

**Результат:**
- Компонент отображается
- Вкладки переключаются

#### 3.2 Общий оборот за месяц (3 часа)
**Задачи:**
- Создать компонент `MonthlyTurnover.tsx`
- Реализовать карточку с общей суммой оборота:
  - Отобразить сумму за текущий месяц
  - Отобразить изменение по сравнению с предыдущим месяцем (в процентах и абсолютных значениях)
  - Добавить индикатор роста/падения (зелёный/красный)
- Реализовать график оборота:
  - Использовать библиотеку для графиков (Chart.js или Recharts)
  - Отобразить оборот по дням текущего месяца
  - Добавить возможность переключения на просмотр по неделям
  - Добавить легенду и подписи осей
- Реализовать выбор периода:
  - Селектор для выбора месяца
  - Кнопки для быстрого выбора (текущий месяц, прошлый месяц)
- При загрузке:
  - Вызвать `directorApi.getMonthlyTurnover(period)`
  - Отобразить данные на графике
  - Показать индикатор загрузки
  - Обработать ошибки

**Результат:**
- Карточка с оборотом отображается
- График работает
- Выбор периода функционирует
- Данные загружаются из API

#### 3.3 Чистая прибыль (3 часа)
**Задачи:**
- Создать компонент `NetProfit.tsx`
- Реализовать селектор периода:
  - Календарь для выбора дат (DatePicker.RangePicker из Ant Design)
  - Предустановленные периоды (кнопки):
    - Сегодня
    - Вчера
    - Эта неделя
    - Этот месяц
    - Прошлый месяц
    - Этот квартал
    - Прошлый квартал
    - Этот год
    - Прошлый год
  - Произвольный период через календарь
- Реализовать карточку с чистой прибылью:
  - Отобразить сумму прибыли за выбранный период
  - Отобразить изменение по сравнению с предыдущим периодом
  - Добавить индикатор роста/падения
- Реализовать график прибыли:
  - Линейный график за выбранный период
  - Отображение по дням/неделям/месяцам (в зависимости от периода)
- Реализовать круговую диаграмму:
  - Показать разбивку доходов и расходов
  - Отобразить процентное соотношение
  - Добавить легенду с суммами
- Реализовать таблицу с разбивкой:
  - Доходы по статьям
  - Расходы по статьям
  - Итоговая прибыль
- При выборе периода:
  - Вызвать `directorApi.getNetProfit(period)`
  - Обновить графики и таблицы
  - Показать индикатор загрузки

**Результат:**
- Селектор периода работает
- Карточка с прибылью отображается
- Графики функционируют
- Данные загружаются корректно

#### 3.4 Детализация доходов и расходов (3 часа)
**Задачи:**
- Создать компонент `IncomeExpenseDetail.tsx`
- Реализовать вкладки:
  - "Доходы" - детализация доходов
  - "Расходы" - детализация расходов
- Реализовать селектор периода (аналогично NetProfit)
- Реализовать таблицу доходов:
  - Колонки:
    - Дата
    - Категория (выручка от заказов, комиссии от партнёров, прочие доходы)
    - Сумма
    - Описание
    - Детали (ссылка на заказ/партнёра)
  - Добавить группировку по категориям
  - Добавить итоговую строку с общей суммой
  - Добавить пагинацию
  - Добавить фильтры по категориям
- Реализовать таблицу расходов:
  - Колонки:
    - Дата
    - Категория (выплаты экспертам, выплаты партнёрам, операционные расходы, налоги)
    - Сумма
    - Описание
    - Получатель (эксперт/партнёр)
  - Добавить группировку по категориям
  - Добавить итоговую строку с общей суммой
  - Добавить пагинацию
  - Добавить фильтры по категориям
- Реализовать экспорт данных:
  - Кнопка "Экспорт в Excel"
  - Кнопка "Экспорт в CSV"
  - Кнопка "Экспорт в PDF"
  - При нажатии вызвать `directorApi.exportFinancialData(period, format)`
  - Показать сообщение об успехе/ошибке
- При загрузке:
  - Вызвать `directorApi.getIncomeDetail(period)` для доходов
  - Вызвать `directorApi.getExpenseDetail(period)` для расходов
  - Отобразить данные в таблицах
  - Показать индикатор загрузки

**Результат:**
- Таблицы отображаются
- Фильтры работают
- Экспорт данных функционирует
- Данные загружаются из API

---

### Этап 4: Панель партнёров (0.5 дня)

#### 4.1 Компонент панели партнёров (1 час)
**Задачи:**
- Создать компонент `PartnerPanel.tsx`
- Реализовать вкладки:
  - "Список партнёров" - список всех партнёров
  - "Оборот по партнёрам" - оборот каждого партнёра
- Добавить состояние для активной вкладки
- Реализовать переключение между вкладками

**Результат:**
- Компонент отображается
- Вкладки переключаются

#### 4.2 Список партнёров (2 часа)
**Задачи:**
- Создать компонент `PartnerList.tsx`
- Реализовать карточку с общим количеством активных партнёров:
  - Отобразить число активных партнёров
  - Отобразить общее количество партнёров
- Реализовать таблицу со списком партнёров:
  - Колонки:
    - Имя и фамилия
    - Email
    - Телефон
    - Дата регистрации
    - Реферальный код
    - Процент комиссии
    - Всего рефералов
    - Активных рефералов
    - Общий доход
    - Статус (активен/неактивен)
    - Действия
  - Добавить пагинацию
  - Добавить фильтры:
    - По статусу (все, активные, неактивные)
    - По дате регистрации
    - По количеству рефералов
  - Добавить поиск по имени/email
  - Добавить сортировку по колонкам
- Реализовать действия для каждого партнёра:
  - "Просмотр" - открывает модальное окно с детальной информацией
  - "Изменить процент" - открывает форму для изменения процента комиссии
  - "Деактивировать/Активировать" - переключает статус партнёра
  - "Список рефералов" - открывает модальное окно со списком рефералов
- Реализовать модальное окно с детальной информацией:
  - Все данные партнёра
  - График доходов партнёра
  - Список рефералов (таблица)
- При загрузке:
  - Вызвать `directorApi.getPartners()`
  - Отобразить данные в таблице
  - Показать индикатор загрузки

**Результат:**
- Карточка с количеством партнёров отображается
- Таблица работает
- Фильтры и поиск функционируют
- Действия выполняются

#### 4.3 Оборот по партнёрам (1 час)
**Задачи:**
- Создать компонент `PartnerTurnover.tsx`
- Реализовать селектор периода:
  - Селектор месяца (по умолчанию - текущий месяц)
  - Кнопки для быстрого выбора (текущий месяц, прошлый месяц)
- Реализовать таблицу с оборотами:
  - Колонки:
    - Имя партнёра
    - Email
    - Количество рефералов
    - Сумма оборота за период
    - Комиссия партнёра
    - Процент от общего оборота
  - Добавить сортировку по обороту
  - Добавить итоговую строку с общим оборотом
- Реализовать график оборота:
  - Столбчатая диаграмма с оборотом каждого партнёра
  - Отсортировать по убыванию оборота
  - Добавить подписи и легенду
- Реализовать топ партнёров:
  - Отобразить топ-5 партнёров по обороту
  - Показать их вклад в общий оборот
- При выборе периода:
  - Вызвать `directorApi.getAllPartnersTurnover(period)`
  - Обновить таблицу и график
  - Показать индикатор загрузки

**Результат:**
- Таблица с оборотами отображается
- График работает
- Селектор периода функционирует
- Данные загружаются из API

---

### Этап 5: Общая статистика (0.5 дня)

#### 5.1 Компонент общей статистики (2 часа)
**Задачи:**
- Создать компонент `GeneralStatistics.tsx`
- Реализовать селектор периода (аналогично NetProfit)
- Реализовать дашборд с карточками KPI:
  - Создать компонент `KPICards.tsx`
  - Карточки:
    - Общий оборот за период
    - Чистая прибыль
    - Количество активных заказов
    - Средний чек
    - Количество клиентов
    - Количество экспертов
    - Количество партнёров
    - Конверсия (опционально)
  - Каждая карточка:
    - Отображает значение показателя
    - Отображает изменение по сравнению с предыдущим периодом
    - Имеет индикатор роста/падения
    - Имеет иконку
    - Кликабельна (переход к детальной информации)
- Реализовать графики трендов:
  - График оборота за период (линейный)
  - График прибыли за период (линейный)
  - График количества заказов за период (линейный)
- Реализовать сравнительную таблицу:
  - Сравнение текущего периода с предыдущим
  - Показать изменение в процентах и абсолютных значениях
- Реализовать кнопку экспорта отчёта:
  - Кнопка "Экспорт отчёта"
  - При нажатии вызвать функцию экспорта
  - Показать выбор формата (Excel, PDF)
- При загрузке:
  - Вызвать `directorApi.getKPI(period)`
  - Вызвать `directorApi.getStatisticsSummary(period)`
  - Отобразить данные в карточках и графиках
  - Показать индикатор загрузки

**Результат:**
- Дашборд отображается
- Карточки KPI работают
- Графики функционируют
- Экспорт отчётов работает
- Данные загружаются из API

#### 5.2 Интеграция и тестирование (2 часа)
**Задачи:**
- Проверить все компоненты на работоспособность
- Протестировать навигацию между разделами
- Протестировать все формы и валидацию
- Протестировать все действия (создание, редактирование, удаление)
- Проверить обработку ошибок
- Проверить индикаторы загрузки
- Проверить адаптивность (на разных размерах экрана)
- Исправить найденные ошибки
- Оптимизировать производительность (если необходимо)

**Результат:**
- Все компоненты работают корректно
- Ошибки исправлены
- Приложение готово к использованию

---

## 6. Критерии приёмки

### 6.1 Функциональные требования
- ✅ Все функции из ТЗ реализованы
- ✅ Все API endpoints работают корректно
- ✅ Валидация форм работает
- ✅ Обработка ошибок реализована
- ✅ Экспорт данных работает

### 6.2 Технические требования
- ✅ Код соответствует стандартам проекта
- ✅ Типизация TypeScript полная
- ✅ Компоненты переиспользуемые
- ✅ Производительность приёмлемая
- ✅ Безопасность обеспечена

### 6.3 UX требования
- ✅ Интерфейс интуитивно понятный
- ✅ Адаптивная вёрстка работает
- ✅ Графики отображаются корректно
- ✅ Уведомления работают
- ✅ Навигация удобная

---

## 7. Дополнительные требования

### 7.1 Безопасность
- Проверка прав доступа на каждом запросе
- Валидация всех входных данных
- Защита от SQL-инъекций
- Защита от XSS-атак
- Логирование действий директора

### 7.2 Производительность
- Кэширование часто запрашиваемых данных
- Пагинация больших списков
- Ленивая загрузка компонентов
- Оптимизация запросов к БД

### 7.3 Тестирование
- Unit-тесты для компонентов
- Integration-тесты для API
- E2E-тесты для критичных сценариев

---

## 8. Сроки и бюджет

- **Срок разработки:** 5 дней
- **Бюджет:** 10 000 (единицы не указаны)

---

## 9. Контакты

- **Разработчик:** [Указать имя]
- **Директор проекта:** [Указать имя]
- **Дата создания ТЗ:** [Текущая дата]
- **Версия ТЗ:** 1.0

