# ü§ñ Telegram –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

–ü—Ä–æ—Å—Ç–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram –±–æ—Ç–∞ **–±–µ–∑ –≤–∏–¥–∂–µ—Ç–æ–≤ –∏ ngrok**.

### –ü—Ä–æ—Ü–µ—Å—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:

1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç –∏–∫–æ–Ω–∫—É **Telegram** –Ω–∞ —Å–∞–π—Ç–µ
2. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –±–æ—Ç `@okoznaniybot` —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º ID –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
3. –ë–æ—Ç —Å–æ–∑–¥–∞–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç JWT —Ç–æ–∫–µ–Ω—ã
4. –¢–æ–∫–µ–Ω—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ Redis –∫–µ—à –Ω–∞ 5 –º–∏–Ω—É—Ç
5. –°–∞–π—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
6. –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Ö–æ–¥–∏—Ç –Ω–∞ —Å–∞–π—Ç

## ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

- ‚úÖ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ localhost –±–µ–∑ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç Telegram Login Widget
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç ngrok –∏–ª–∏ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –¥–æ–º–µ–Ω–∞
- ‚úÖ –ù–µ —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–º–µ–Ω–∞ –≤ BotFather
- ‚úÖ –ü—Ä–æ—Å—Ç–∞—è –∏ –Ω–∞–¥–µ–∂–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—Ö–æ–¥ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤ –±–æ—Ç–µ

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞: http://localhost:3000/login
2. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∏–∫–æ–Ω–∫—É Telegram (—Ä—è–¥–æ–º —Å Google –∏ VK)
3. –í –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è –±–æ—Ç–µ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
4. –í–µ—Ä–Ω–∏—Ç–µ—Å—å –Ω–∞ —Å–∞–π—Ç - –≤—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–æ–π–¥–µ—Ç–µ!

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:

–ë–æ—Ç —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç. –ù–∏–∫–∞–∫–∏—Ö –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è.

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### Frontend (SocialLoginButtons.tsx)

```typescript
const handleTelegramAuth = () => {
  const authId = generateAuthId();
  localStorage.setItem('telegram_auth_id', authId);
  
  // –û—Ç–∫—Ä—ã–≤–∞–µ–º –±–æ—Ç–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
  window.open(`https://t.me/okoznaniybot?start=auth_${authId}`, '_blank');
  
  // –ù–∞—á–∏–Ω–∞–µ–º –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Å—Ç–∞—Ç—É—Å
  checkAuthStatus(authId);
};
```

### Backend (bot/bot.py)

```python
@dp.message(Command("start"))
async def cmd_start(message: types.Message):
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    if auth_id:
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω—ã
        refresh = RefreshToken.for_user(user)
        
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ –∫–µ—à
        cache.set(f'telegram_auth_{auth_id}', auth_data, 300)
```

### API Endpoint (apps/users/views.py)

```python
@api_view(['GET'])
def telegram_auth_status(request, auth_id):
    auth_data = cache.get(f'telegram_auth_{auth_id}')
    if auth_data:
        cache.delete(f'telegram_auth_{auth_id}')
        return Response(auth_data)
    return Response({'authenticated': False})
```

## üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)

```env
TELEGRAM_BOT_TOKEN=your_bot_token
FRONTEND_URL=http://localhost:3000
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–æ—Ç–∞

–ë–æ—Ç —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ `bot/bot.py`. –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ Docker.

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞

```bash
docker logs okoznaniy-telegram-bot-1 --tail 50
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ backend

```bash
docker logs okoznaniy-backend-1 --tail 50
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Redis –∫–µ—à–∞

```bash
docker exec okoznaniy-redis-1 redis-cli KEYS "telegram_auth_*"
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –£–Ω–∏–∫–∞–ª—å–Ω—ã–π ID –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–ø—ã—Ç–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –¢–æ–∫–µ–Ω—ã —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ Redis —Ç–æ–ª—å–∫–æ 5 –º–∏–Ω—É—Ç
- –ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω—ã —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ –∫–µ—à–∞
- JWT —Ç–æ–∫–µ–Ω—ã —Å –∫–æ—Ä–æ—Ç–∫–∏–º –≤—Ä–µ–º–µ–Ω–µ–º –∂–∏–∑–Ω–∏

## üìö –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- `frontend-react/src/components/auth/SocialLoginButtons.tsx` - –ö–Ω–æ–ø–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- `bot/bot.py` - Telegram –±–æ—Ç
- `apps/users/views.py` - API endpoint –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
- `apps/users/urls.py` - URL –º–∞—Ä—à—Ä—É—Ç—ã

---

**–í—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –∫–æ—Ä–æ–±–∫–∏! –ü—Ä–æ—Å—Ç–æ –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –∏ –∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å —á–µ—Ä–µ–∑ –±–æ—Ç–∞.** üéâ
