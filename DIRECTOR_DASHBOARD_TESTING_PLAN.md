# План тестирования личного кабинета директора

## Обзор функциональности

Личный кабинет директора включает следующие основные разделы:
1. **Управление персоналом** - прием и увольнение сотрудников
2. **Финансовая статистика** - оборот и прибыль компании
3. **Панель партнёров** - управление партнерами и их оборотом
4. **Общая статистика** - сводка по всем показателям
5. **Коммуникация с арбитрами** - связь с арбитрами

## Этап 1: Подготовка к тестированию

### 1.1 Проверка доступа директора
```bash
# Проверить, что контейнеры запущены
docker-compose ps

# Проверить логи backend
docker-compose logs backend

# Проверить логи frontend
docker-compose logs frontend
```

**Ожидаемый результат:** Все сервисы работают без ошибок

### 1.2 Создание тестового аккаунта директора
```bash
# Выполнить в контейнере backend
docker-compose exec backend python manage.py shell
```

```python
# В Django shell
from django.contrib.auth import get_user_model
User = get_user_model()

# Создать директора если не существует
director, created = User.objects.get_or_create(
    email='director@test.com',
    defaults={
        'username': 'director',
        'role': 'admin',
        'is_staff': True,
        'is_superuser': True,
        'first_name': 'Директор',
        'last_name': 'Тестовый'
    }
)

if created:
    director.set_password('test123')
    director.save()
    print("Директор создан")
else:
    print("Директор уже существует")

exit()
```

**Ожидаемый результат:** Аккаунт директора создан или уже существует

### 1.3 Проверка доступности интерфейса
- Открыть http://localhost:5173
- Перейти на страницу входа администратора: http://localhost:5173/administrator
- Войти с данными: director@test.com / test123

**Ожидаемый результат:** Успешный вход в личный кабинет директора

## Этап 2: Тестирование управления персоналом

### 2.1 Просмотр списка сотрудников
**Действия:**
1. В личном кабинете директора выбрать "Управление персоналом"
2. Проверить отображение списка активных сотрудников
3. Проверить фильтры по ролям (admin, expert, partner, arbitrator)

**Ожидаемый результат:**
- Отображается список сотрудников с их ролями
- Фильтры работают корректно
- Показываются только активные сотрудники (is_active=True)

### 2.2 Регистрация нового сотрудника
**Действия:**
1. Нажать кнопку "Добавить сотрудника"
2. Заполнить форму:
   - Email: test-expert@example.com
   - Имя: Тестовый
   - Фамилия: Эксперт
   - Роль: expert
   - Пароль: (автогенерация или ввод)
3. Сохранить

**Ожидаемый результат:**
- Сотрудник успешно создан
- Появился в списке активных сотрудников
- Роль назначена корректно

### 2.3 Управление заявками экспертов
**Действия:**
1. Перейти в раздел "Заявки экспертов"
2. Просмотреть список поданных заявок
3. Одобрить заявку (кнопка "Одобрить")
4. Отклонить заявку с указанием причины
5. Отправить на доработку с комментарием

**Ожидаемый результат:**
- Заявки отображаются с полной информацией
- Одобрение меняет статус пользователя на expert
- Отклонение возвращает роль client
- Доработка оставляет статус pending

### 2.4 Деактивация сотрудника
**Действия:**
1. Выбрать активного эксперта
2. Нажать "Деактивировать"
3. Подтвердить действие

**Ожидаемый результат:**
- Роль эксперта изменена на client
- Статус заявки изменен на deactivated
- Сотрудник исчез из списка активных

### 2.5 Архивирование сотрудника
**Действия:**
1. Выбрать сотрудника (не эксперта)
2. Нажать "Архивировать"
3. Подтвердить действие

**Ожидаемый результат:**
- is_active установлен в False
- Сотрудник исчез из основного списка

### 2.6 Просмотр архива
**Действия:**
1. Перейти в раздел "Архив"
2. Просмотреть заархивированных сотрудников
3. Восстановить одного из них

**Ожидаемый результат:**
- Отображаются архивированные и деактивированные сотрудники
- Восстановление возвращает сотрудника в активные

## Этап 3: Тестирование финансовой статистики

### 3.1 Общий оборот за месяц
**Действия:**
1. Перейти в "Финансовая статистика"
2. Проверить отображение оборота за текущий месяц
3. Изменить период (выбрать другой месяц)

**Ожидаемый результат:**
- Отображается сумма оборота с 1-го по 1-е число
- Данные обновляются при смене периода
- Показывается график динамики

### 3.2 Чистая прибыль компании
**Действия:**
1. Проверить отображение чистой прибыли
2. Сравнить с предыдущим периодом
3. Просмотреть детализацию

**Ожидаемый результат:**
- Показывается чистая прибыль (доходы - расходы)
- Есть сравнение с предыдущим периодом
- Доступна детализация по статьям

### 3.3 Детализация доходов и расходов
**Действия:**
1. Открыть детализацию доходов
2. Открыть детализацию расходов
3. Проверить фильтры по категориям

**Ожидаемый результат:**
- Доходы разбиты по источникам (заказы, магазин, партнеры)
- Расходы разбиты по категориям (комиссии, операционные)
- Фильтры работают корректно

## Этап 4: Тестирование панели партнёров

### 4.1 Список партнёров
**Действия:**
1. Перейти в "Панель партнёров"
2. Просмотреть список активных партнеров
3. Проверить информацию о каждом партнере

**Ожидаемый результат:**
- Отображается количество активных партнеров
- Показывается основная информация по каждому
- Есть статистика активности

### 4.2 Оборот по партнёрам
**Действия:**
1. Просмотреть ежемесячный оборот каждого партнера
2. Отсортировать по убыванию оборота
3. Выбрать период для анализа

**Ожидаемый результат:**
- Показывается оборот с 1-го по 1-е число месяца
- Сортировка работает корректно
- Данные обновляются при смене периода

### 4.3 Детализация по партнеру
**Действия:**
1. Выбрать конкретного партнера
2. Просмотреть детальную статистику
3. Проанализировать динамику

**Ожидаемый результат:**
- Показывается подробная информация о партнере
- Есть график динамики оборота
- Отображаются ключевые метрики

## Этап 5: Тестирование общей статистики

### 5.1 Сводка финансовых показателей
**Действия:**
1. Перейти в "Общая статистика"
2. Просмотреть все ключевые метрики
3. Проверить актуальность данных

**Ожидаемый результат:**
- Отображаются все основные показатели
- Данные актуальные и корректные
- Есть сравнение с предыдущими периодами

### 5.2 Графики и диаграммы
**Действия:**
1. Проверить отображение графиков
2. Взаимодействовать с интерактивными элементами
3. Экспортировать данные (если доступно)

**Ожидаемый результат:**
- Графики отображаются корректно
- Интерактивность работает
- Экспорт функционирует (если реализован)

## Этап 6: Тестирование коммуникации с арбитрами

### 6.1 Список арбитров
**Действия:**
1. Перейти в "Коммуникация с арбитрами"
2. Просмотреть список арбитров
3. Проверить их статусы

**Ожидаемый результат:**
- Отображается список всех арбитров
- Показываются их статусы (активен/неактивен)
- Есть информация о загруженности

### 6.2 Отправка сообщений
**Действия:**
1. Выбрать арбитра
2. Отправить сообщение
3. Проверить доставку

**Ожидаемый результат:**
- Сообщение успешно отправлено
- Арбитр получил уведомление
- История сообщений сохраняется

## Этап 7: Тестирование адаптивности и производительности

### 7.1 Мобильная версия
**Действия:**
1. Открыть интерфейс на мобильном устройстве
2. Проверить все основные функции
3. Протестировать навигацию

**Ожидаемый результат:**
- Интерфейс адаптируется под мобильные экраны
- Все функции доступны
- Навигация удобная

### 7.2 Производительность
**Действия:**
1. Проверить скорость загрузки страниц
2. Протестировать с большим объемом данных
3. Проверить отзывчивость интерфейса

**Ожидаемый результат:**
- Страницы загружаются быстро (< 3 сек)
- Интерфейс остается отзывчивым
- Нет зависаний при работе с данными

## Этап 8: Проверка безопасности и прав доступа

### 8.1 Проверка авторизации
**Действия:**
1. Попытаться зайти без авторизации
2. Войти под обычным пользователем
3. Проверить доступ к API директора

**Ожидаемый результат:**
- Неавторизованные пользователи перенаправляются на вход
- Обычные пользователи не имеют доступа к функциям директора
- API защищено соответствующими правами

### 8.2 Проверка CSRF и других уязвимостей
**Действия:**
1. Проверить наличие CSRF токенов
2. Протестировать SQL инъекции (базовые)
3. Проверить XSS защиту

**Ожидаемый результат:**
- CSRF токены присутствуют
- SQL инъекции блокируются
- XSS атаки предотвращаются

## Этап 9: Тестирование интеграций

### 9.1 Интеграция с базой данных
**Действия:**
1. Проверить корректность SQL запросов
2. Протестировать транзакции
3. Проверить индексы для производительности

**Ожидаемый результат:**
- Запросы выполняются корректно
- Транзакции работают атомарно
- Производительность запросов приемлемая

### 9.2 Интеграция с уведомлениями
**Действия:**
1. Проверить отправку уведомлений при действиях
2. Протестировать email уведомления
3. Проверить push уведомления (если есть)

**Ожидаемый результат:**
- Уведомления отправляются своевременно
- Email доставляются корректно
- Push уведомления работают

## Этап 10: Финальная проверка

### 10.1 Комплексный тест
**Действия:**
1. Выполнить полный цикл работы директора
2. Проверить все основные сценарии
3. Протестировать граничные случаи

**Ожидаемый результат:**
- Все функции работают в связке
- Нет критических ошибок
- Пользовательский опыт положительный

### 10.2 Проверка логов
**Действия:**
```bash
# Проверить логи на ошибки
docker-compose logs backend | grep -i error
docker-compose logs frontend | grep -i error

# Проверить логи базы данных
docker-compose logs postgres | grep -i error
```

**Ожидаемый результат:**
- Нет критических ошибок в логах
- Предупреждения минимальны и объяснимы

## Чек-лист готовности к продакшену

- [ ] Все функции управления персоналом работают
- [ ] Финансовая статистика отображается корректно
- [ ] Панель партнёров функционирует
- [ ] Общая статистика доступна
- [ ] Коммуникация с арбитрами работает
- [ ] Мобильная версия адаптивна
- [ ] Производительность приемлемая
- [ ] Безопасность обеспечена
- [ ] Интеграции функционируют
- [ ] Логи чистые от критических ошибок

## Возможные проблемы и решения

### Проблема: Не отображаются данные статистики
**Решение:**
1. Проверить наличие тестовых данных в БД
2. Убедиться в корректности API запросов
3. Проверить права доступа к данным

### Проблема: Ошибки при управлении персоналом
**Решение:**
1. Проверить миграции БД
2. Убедиться в корректности сериализаторов
3. Проверить права доступа к моделям

### Проблема: Медленная загрузка
**Решение:**
1. Оптимизировать SQL запросы
2. Добавить кэширование
3. Проверить индексы БД

### Проблема: Ошибки авторизации
**Решение:**
1. Проверить настройки JWT токенов
2. Убедиться в корректности middleware
3. Проверить права доступа в views

## Заключение

Данный план покрывает все основные аспекты тестирования личного кабинета директора. Выполнение всех этапов гарантирует готовность системы к использованию в продакшене.

Рекомендуется выполнять тестирование поэтапно, документируя все найденные проблемы и их решения.