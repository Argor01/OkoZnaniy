# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –ø—Ä–µ—Ç–µ–Ω–∑–∏–π

## –ü—Ä–æ–±–ª–µ–º–∞
–û—à–∏–±–∫–∞ 403 –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏: "–£ –≤–∞—Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω–æ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è"

## –ü—Ä–∏—á–∏–Ω–∞
API `/api/admin-panel/claims/` —Ç—Ä–µ–±–æ–≤–∞–ª –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –¥–ª—è –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π, –≤–∫–ª—é—á–∞—è —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ—Ç–µ–Ω–∑–∏–π.

## –†–µ—à–µ–Ω–∏–µ
–ò–∑–º–µ–Ω–µ–Ω—ã –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –≤ `apps/admin_panel/views.py`:
- ‚úÖ –õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –ø—Ä–µ—Ç–µ–Ω–∑–∏—é
- ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏
- ‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≤–∏–¥—è—Ç –≤—Å–µ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏
- ‚úÖ –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏ (–±—Ä–∞—Ç—å –≤ —Ä–∞–±–æ—Ç—É, –∑–∞–≤–µ—Ä—à–∞—Ç—å)

## –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ß–µ—Ä–µ–∑ Docker (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –±—ç–∫–µ–Ω–¥
docker-compose restart backend

# –ü–æ–¥–æ–∂–¥–∏—Ç–µ 10-15 —Å–µ–∫—É–Ω–¥, –ø–æ–∫–∞ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–ª–Ω–∞—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
docker-compose ps
```

### –í–∞—Ä–∏–∞–Ω—Ç 3: –õ–æ–∫–∞–ª—å–Ω–æ (–µ—Å–ª–∏ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Docker)

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä (Ctrl+C)

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
python manage.py runserver
```

## –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–µ—Å—Ç

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
docker-compose exec backend python test_claim_permissions.py
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
```
‚úÖ –≠–∫—Å–ø–µ—Ä—Ç —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–µ—Ç–µ–Ω–∑–∏—é: –ü–†–û–ô–î–ï–ù
‚úÖ –ö–ª–∏–µ–Ω—Ç —Å–æ–∑–¥–∞–µ—Ç –ø—Ä–µ—Ç–µ–Ω–∑–∏—é: –ü–†–û–ô–î–ï–ù
‚úÖ –≠–∫—Å–ø–µ—Ä—Ç –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏: –ü–†–û–ô–î–ï–ù
‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –≤–∏–¥–∏—Ç –≤—Å–µ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏: –ü–†–û–ô–î–ï–ù
‚úÖ –≠–∫—Å–ø–µ—Ä—Ç –Ω–µ –º–æ–∂–µ—Ç –≤–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É: –ü–†–û–ô–î–ï–ù

–í–°–ï –¢–ï–°–¢–´ –ü–†–û–ô–î–ï–ù–´ –£–°–ü–ï–®–ù–û! üéâ
```

### –†—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥

1. **–û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç:** http://localhost:5173

2. **–í–æ–π–¥–∏—Ç–µ –∫–∞–∫ —ç–∫—Å–ø–µ—Ä—Ç –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç**

3. **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–æ–∑–¥–∞—Ç—å –ø—Ä–µ—Ç–µ–Ω–∑–∏—é:**
   - –û—Ç–∫—Ä–æ–π—Ç–µ —á–∞—Ç
   - –ù–∞–∂–º–∏—Ç–µ "–ü–æ–¥–∞—Ç—å –ø—Ä–µ—Ç–µ–Ω–∑–∏—é"
   - –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É
   - –ù–∞–∂–º–∏—Ç–µ "–û—Ç–ø—Ä–∞–≤–∏—Ç—å"

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ:**
   - ‚úÖ –ü—Ä–µ—Ç–µ–Ω–∑–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–∫–∏ 403
   - ‚úÖ –ü–æ—è–≤–ª—è–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
   - ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12)

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ API

```bash
# –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—ç–∫—Å–ø–µ—Ä—Ç–∞ –∏–ª–∏ –∫–ª–∏–µ–Ω—Ç–∞)
docker-compose exec backend python manage.py shell

# –í shell:
from rest_framework.authtoken.models import Token
from django.contrib.auth import get_user_model

User = get_user_model()
user = User.objects.get(username='–≤–∞—à_username')
token, created = Token.objects.get_or_create(user=user)
print(f"Token: {token.key}")
```

–ó–∞—Ç–µ–º:

```bash
# –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–µ—Ç–µ–Ω–∑–∏—é —á–µ—Ä–µ–∑ API
curl -X POST http://localhost:8000/api/admin-panel/claims/ \
  -H "Authorization: Token YOUR_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{
    "claim_type": "quality",
    "subject": "–¢–µ—Å—Ç API",
    "description": "–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞"
  }'
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:** –°—Ç–∞—Ç—É—Å 201 Created

## –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å

### –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```python
class ClaimViewSet(viewsets.ModelViewSet):
    permission_classes = [IsAdminUser]  # ‚ùå –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã
```

### –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```python
class ClaimViewSet(viewsets.ModelViewSet):
    permission_classes = [IsAuthenticated]  # ‚úÖ –õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π
    
    def get_permissions(self):
        if self.action == 'create':
            return [IsAuthenticated()]  # ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ - –≤—Å–µ
        elif self.action in ['list', 'retrieve']:
            return [IsAuthenticated()]  # ‚úÖ –ü—Ä–æ—Å–º–æ—Ç—Ä - –≤—Å–µ (–Ω–æ —Å–≤–æ–∏)
        else:
            return [IsAdminUser()]  # ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ - —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã
    
    def get_queryset(self):
        if user.role == 'admin':
            return queryset  # –ê–¥–º–∏–Ω—ã –≤–∏–¥—è—Ç –≤—Å–µ
        return queryset.filter(user=user)  # –û—Å—Ç–∞–ª—å–Ω—ã–µ - —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏
```

## –ú–∞—Ç—Ä–∏—Ü–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

| –î–µ–π—Å—Ç–≤–∏–µ | –≠–∫—Å–ø–µ—Ä—Ç | –ö–ª–∏–µ–Ω—Ç | –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä |
|----------|---------|--------|---------------|
| –°–æ–∑–¥–∞—Ç—å –ø—Ä–µ—Ç–µ–Ω–∑–∏—é | ‚úÖ | ‚úÖ | ‚úÖ |
| –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–∏ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏ | ‚úÖ | ‚úÖ | ‚úÖ |
| –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≤—Å–µ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏ | ‚ùå | ‚ùå | ‚úÖ |
| –í–∑—è—Ç—å –≤ —Ä–∞–±–æ—Ç—É | ‚ùå | ‚ùå | ‚úÖ |
| –ó–∞–≤–µ—Ä—à–∏—Ç—å | ‚ùå | ‚ùå | ‚úÖ |
| –û—Ç–∫–ª–æ–Ω–∏—Ç—å | ‚ùå | ‚ùå | ‚úÖ |

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ 403 –≤—Å—ë –µ—â—ë –ø–æ—è–≤–ª—è–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ë—ç–∫–µ–Ω–¥ –Ω–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏–ª—Å—è –∏–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ø—Ä–∏–º–µ–Ω–∏–ª–∏—Å—å

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –±—ç–∫–µ–Ω–¥ –∑–∞–ø—É—â–µ–Ω
docker-compose ps

# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ
docker-compose restart backend

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏
docker-compose logs backend --tail=50
```

### –ü—Ä–µ—Ç–µ–Ω–∑–∏—è —Å–æ–∑–¥–∞–µ—Ç—Å—è, –Ω–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç `perform_create`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–¥ –≤ views.py
docker-compose exec backend cat apps/admin_panel/views.py | grep -A 5 "perform_create"

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
# def perform_create(self, serializer):
#     serializer.save(user=self.request.user)
```

### –≠–∫—Å–ø–µ—Ä—Ç –≤–∏–¥–∏—Ç —á—É–∂–∏–µ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –≤ `get_queryset`

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–æ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
docker-compose exec backend python manage.py shell

>>> from django.contrib.auth import get_user_model
>>> User = get_user_model()
>>> user = User.objects.get(username='–≤–∞—à_username')
>>> print(user.role)  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 'expert' –∏–ª–∏ 'client', –Ω–µ 'admin'
```

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã

### –¢–µ—Å—Ç 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏ —Å –∑–∞–∫–∞–∑–æ–º

```bash
docker-compose exec backend python manage.py shell

from django.contrib.auth import get_user_model
from apps.orders.models import Order
from apps.admin_panel.models import Claim

User = get_user_model()
expert = User.objects.filter(role='expert').first()
order = Order.objects.filter(expert=expert).first()

if order:
    claim = Claim.objects.create(
        user=expert,
        order=order,
        claim_type='quality',
        subject='–¢–µ—Å—Ç —Å –∑–∞–∫–∞–∑–æ–º',
        description='–ü—Ä–µ—Ç–µ–Ω–∑–∏—è —Å–≤—è–∑–∞–Ω–∞ —Å –∑–∞–∫–∞–∑–æ–º'
    )
    print(f"–ü—Ä–µ—Ç–µ–Ω–∑–∏—è #{claim.id} —Å–æ–∑–¥–∞–Ω–∞ —Å –∑–∞–∫–∞–∑–æ–º #{order.id}")
```

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤

```bash
# –°–ø–∏—Å–æ–∫ –ø—Ä–µ—Ç–µ–Ω–∑–∏–π (–∫–∞–∫ —ç–∫—Å–ø–µ—Ä—Ç)
curl http://localhost:8000/api/admin-panel/claims/ \
  -H "Authorization: Token EXPERT_TOKEN"

# –°–ø–∏—Å–æ–∫ –ø—Ä–µ—Ç–µ–Ω–∑–∏–π (–∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
curl http://localhost:8000/api/admin-panel/claims/ \
  -H "Authorization: Token ADMIN_TOKEN"

# –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω –≤–∏–¥–µ—Ç—å –±–æ–ª—å—à–µ –ø—Ä–µ—Ç–µ–Ω–∑–∏–π
```

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
1. ‚úÖ –≠–∫—Å–ø–µ—Ä—Ç—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏
2. ‚úÖ –ö–ª–∏–µ–Ω—Ç—ã –º–æ–≥—É—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏
3. ‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏
4. ‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –≤–∏–¥—è—Ç –≤—Å–µ –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏
5. ‚úÖ –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –ø—Ä–µ—Ç–µ–Ω–∑–∏–∏
6. ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ 403 –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏

**–¢–µ–ø–µ—Ä—å —Å–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ!** üéâ
