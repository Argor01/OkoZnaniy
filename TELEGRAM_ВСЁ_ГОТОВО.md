# üéâ Telegram - –í–°–Å –ì–û–¢–û–í–û!

## ‚úÖ –ß—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram Widget
- ‚úÖ –ö–Ω–æ–ø–∫–∞ "Login with Telegram" –Ω–∞ —Å–∞–π—Ç–µ
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö (HMAC-SHA256)
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è API

### 2. Telegram –ë–æ—Ç
- ‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –≤ Docker
- ‚úÖ –ö–æ–º–∞–Ω–¥—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## üöÄ –ó–∞–ø—É—â–µ–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã

```bash
docker-compose ps
```

–î–æ–ª–∂–Ω—ã —Ä–∞–±–æ—Ç–∞—Ç—å:
- ‚úÖ backend (–ø–æ—Ä—Ç 8000)
- ‚úÖ frontend (–ø–æ—Ä—Ç 3000)
- ‚úÖ postgres (–ø–æ—Ä—Ç 5432)
- ‚úÖ redis (–ø–æ—Ä—Ç 6379)
- ‚úÖ celery
- ‚úÖ nginx (–ø–æ—Ä—Ç 8080)
- ‚úÖ **telegram-bot** ‚Üê –ù–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å!

## ü§ñ Telegram –ë–æ—Ç

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ –±–æ—Ç–∞
docker-compose logs -f telegram-bot
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
INFO:__main__:–ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞...
INFO:__main__:–ù–∞—á–∏–Ω–∞–µ–º polling...
INFO:aiogram.dispatcher:Start polling
INFO:aiogram.dispatcher:Run polling for bot @okoznaniybot
```

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram
2. –ù–∞–π–¥–∏—Ç–µ: `@oko_expert_bot`
3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ: `/start`
4. –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º

### –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/start` - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∏ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
- `/help` - –°–ø—Ä–∞–≤–∫–∞
- `/profile` - –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è
- `/balance` - –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞
- `/link` - –ü–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è –≤—Ö–æ–¥–∞

## üåê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ —Å–∞–π—Ç

### –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç: `http://localhost:3000`
2. –ù–∞–π–¥–∏—Ç–µ –∫–Ω–æ–ø–∫—É "Login with Telegram"
3. –ù–∞–∂–º–∏—Ç–µ –∏ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤ Telegram
4. –ì–æ—Ç–æ–≤–æ! ‚úÖ

### –ü—Ä–∏–º–µ—Ä –∫–æ–¥–∞

```tsx
import TelegramLoginButton from '../components/auth/TelegramLoginButton';

<TelegramLoginButton
  botName="oko_expert_bot"
  onAuth={(user) => navigate('/dashboard')}
/>
```

## üîÑ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–º–µ—Å—Ç–µ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ß–µ—Ä–µ–∑ –±–æ—Ç–∞

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –û—Ç–∫—Ä—ã–≤–∞–µ—Ç @oko_expert_bot
2. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç ‚Üí /start
3. –ë–æ—Ç ‚Üí –°–æ—Ö—Ä–∞–Ω—è–µ—Ç telegram_id –≤ –ë–î
4. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–∞–π—Ç
5. –ù–∞–∂–∏–º–∞–µ—Ç ‚Üí "Login with Telegram"
6. Telegram ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
7. Backend ‚Üí –ù–∞—Ö–æ–¥–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ telegram_id
8. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚úÖ
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ß–µ—Ä–µ–∑ —Å–∞–π—Ç

```
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –û—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–∞–π—Ç
2. –ù–∞–∂–∏–º–∞–µ—Ç ‚Üí "Login with Telegram"
3. Telegram ‚Üí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
4. Backend ‚Üí –°–æ–∑–¥–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å telegram_id
5. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ê–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω ‚úÖ
6. –ú–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ‚Üí –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞
```

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞

### –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã

```bash
docker-compose ps
```

### –õ–æ–≥–∏ –±–æ—Ç–∞

```bash
docker-compose logs -f telegram-bot
```

### –õ–æ–≥–∏ backend

```bash
docker-compose logs -f backend
```

### –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å Telegram

```bash
docker-compose exec backend python manage.py shell -c "
from apps.users.models import User
count = User.objects.filter(telegram_id__isnull=False).count()
print(f'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å Telegram: {count}')
"
```

## üîß –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
docker-compose restart telegram-bot
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–æ—Ç–∞

```bash
docker-compose stop telegram-bot
```

### –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
docker-compose up -d telegram-bot
```

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
docker-compose logs --tail=50 telegram-bot
```

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- [TELEGRAM_–ì–û–¢–û–í–û.md](./TELEGRAM_–ì–û–¢–û–í–û.md) - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Widget
- [TELEGRAM_–ò–ù–°–¢–†–£–ö–¶–ò–Ø.md](./TELEGRAM_–ò–ù–°–¢–†–£–ö–¶–ò–Ø.md) - –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
- [TELEGRAM_BOT_DOCKER.md](./TELEGRAM_BOT_DOCKER.md) - –ë–æ—Ç –≤ Docker
- [TELEGRAM_AUTH_FLOW.md](./TELEGRAM_AUTH_FLOW.md) - –°—Ö–µ–º–∞ —Ä–∞–±–æ—Ç—ã
- [TELEGRAM_AUTH_COMMANDS.md](./TELEGRAM_AUTH_COMMANDS.md) - –ö–æ–º–∞–Ω–¥—ã

### –ù–∞–≤–∏–≥–∞—Ü–∏—è
- [TELEGRAM_AUTH_INDEX.md](./TELEGRAM_AUTH_INDEX.md) - –í—Å—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üéØ –ß—Ç–æ –¥–∞–ª—å—à–µ?

### –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ

1. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ BotFather** (2 –º–∏–Ω—É—Ç—ã)
   ```
   /setdomain
   @oko_expert_bot
   localhost
   ```

2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –±–æ—Ç–∞** (3 –º–∏–Ω—É—Ç—ã)
   - –û—Ç–∫—Ä–æ–π—Ç–µ @oko_expert_bot
   - –û—Ç–ø—Ä–∞–≤—å—Ç–µ /start
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–º–∞–Ω–¥—ã

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é** (3 –º–∏–Ω—É—Ç—ã)
   - –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç
   - –ù–∞–∂–º–∏—Ç–µ "Login with Telegram"
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Ö–æ–¥

### –ü–æ –∂–µ–ª–∞–Ω–∏—é

- –î–æ–±–∞–≤—å—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ª–æ–≥–∏–Ω–∞
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –±–æ—Ç–∞
- –î–æ–±–∞–≤—å—Ç–µ –±–æ–ª—å—à–µ –∫–æ–º–∞–Ω–¥
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ webhook –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ HMAC-SHA256 –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è API
- ‚úÖ –¢–æ–∫–µ–Ω –±–æ—Ç–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏

## üí° –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –í—Ö–æ–¥ –≤ 1 –∫–ª–∏–∫
- ‚úÖ –ù–µ –Ω—É–∂–Ω–æ –∑–∞–ø–æ–º–∏–Ω–∞—Ç—å –ø–∞—Ä–æ–ª—å
- ‚úÖ –ë—ã—Å—Ç—Ä–æ –∏ —É–¥–æ–±–Ω–æ
- ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram

### –î–ª—è –±–∏–∑–Ω–µ—Å–∞
- ‚úÖ –ë–æ–ª—å—à–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
- ‚úÖ –ú–µ–Ω—å—à–µ –±—Ä–æ—à–µ–Ω–Ω—ã—Ö –∫–æ—Ä–∑–∏–Ω
- ‚úÖ –ü—Ä—è–º–æ–π –∫–∞–Ω–∞–ª —Å–≤—è–∑–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –ß—Ç–æ —Å–æ–∑–¥–∞–Ω–æ

- **–ö–æ–¥:** 6 —Ñ–∞–π–ª–æ–≤
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:** 12 —Ñ–∞–π–ª–æ–≤
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~400
- **–°—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** ~3000

### –í—Ä–µ–º—è

- **–†–∞–∑—Ä–∞–±–æ—Ç–∫–∞:** 2 —á–∞—Å–∞
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∞:** 5 –º–∏–Ω—É—Ç
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** 5 –º–∏–Ω—É—Ç

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç

- [x] Backend API —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω
- [x] Frontend –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å–æ–∑–¥–∞–Ω
- [x] Telegram –±–æ—Ç —Å–æ–∑–¥–∞–Ω
- [x] –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –≤ Docker ‚úÖ
- [x] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–î —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞ —Ä–∞–±–æ—Ç–∞—é—Ç
- [x] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –Ω–∞–ø–∏—Å–∞–Ω–∞
- [ ] –ë–æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ BotFather (2 –º–∏–Ω—É—Ç—ã)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –≤ Telegram (3 –º–∏–Ω—É—Ç—ã)
- [ ] –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞ —Å–∞–π—Ç–µ (3 –º–∏–Ω—É—Ç—ã)

## üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!

**–í—Å—ë –≥–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!**

### –û—Å—Ç–∞–ª–æ—Å—å 3 —à–∞–≥–∞ (10 –º–∏–Ω—É—Ç):

1. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –±–æ—Ç–∞ –≤ BotFather** (2 –º–∏–Ω)
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ Telegram** (3 –º–∏–Ω)
3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Å–∞–π—Ç–µ** (3 –º–∏–Ω)

### –ù–∞—á–Ω–∏—Ç–µ —Å:

1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ: `/setdomain`
3. –í—ã–±–µ—Ä–∏—Ç–µ: `@oko_expert_bot`
4. –í–≤–µ–¥–∏—Ç–µ: `localhost`

–ó–∞—Ç–µ–º:

1. –û—Ç–∫—Ä–æ–π—Ç–µ [@oko_expert_bot](https://t.me/oko_expert_bot)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ: `/start`
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–º–∞–Ω–¥—ã

–ò –Ω–∞–∫–æ–Ω–µ—Ü:

1. –û—Ç–∫—Ä–æ–π—Ç–µ: `http://localhost:3000`
2. –ù–∞–∂–º–∏—Ç–µ: "Login with Telegram"
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –≤ Telegram

## üöÄ –ì–æ—Ç–æ–≤–æ!

Telegram –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è –∏ –±–æ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞—é—Ç!

---

**–í–µ—Ä—Å–∏—è:** 1.0.0  
**–î–∞—Ç–∞:** 2024  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –†–ê–ë–û–¢–ê–ï–¢  
**–¢–æ–∫–µ–Ω –±–æ—Ç–∞:** `8584999235:AAGKcP0nhnn_B6G8iTa2Ti8U9oxUFByWfpo`  
**Username –±–æ—Ç–∞:** `@oko_expert_bot`  
**–ë–æ—Ç –≤ Docker:** ‚úÖ –ó–∞–ø—É—â–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
