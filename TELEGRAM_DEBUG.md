# üîç –û—Ç–ª–∞–¥–∫–∞ Telegram –∫–Ω–æ–ø–∫–∏

## –ü—Ä–æ–±–ª–µ–º–∞: –ö–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –®–∞–≥ 1: –û—Ç–∫—Ä–æ–π—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

1. –ù–∞–∂–º–∏—Ç–µ `F12` –∏–ª–∏ `Ctrl+Shift+I`
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "Console"
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É `http://localhost:3000/login`

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

–í—ã –¥–æ–ª–∂–Ω—ã —É–≤–∏–¥–µ—Ç—å:
```
[TelegramLoginButton] Initializing with botName: oko_expert_bot
[TelegramLoginButton] Widget script added to DOM
[TelegramLoginButton] Telegram widget script loaded successfully
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏

#### –û—à–∏–±–∫–∞: "Bot domain invalid"

**–ü—Ä–∏—á–∏–Ω–∞:** –î–æ–º–µ–Ω –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ BotFather

**–†–µ—à–µ–Ω–∏–µ:**
1. –û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather)
2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ: `/setdomain`
3. –í—ã–±–µ—Ä–∏—Ç–µ: `@oko_expert_bot`
4. –í–≤–µ–¥–∏—Ç–µ: `localhost`

#### –û—à–∏–±–∫–∞: "Failed to load script"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü—Ä–æ–±–ª–µ–º–∞ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º –∏–ª–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
2. –û—Ç–∫–ª—é—á–∏—Ç–µ VPN/–ø—Ä–æ–∫—Å–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –ª–∏ –∞–Ω—Ç–∏–≤–∏—Ä—É—Å

#### –û—à–∏–±–∫–∞: "CORS"

**–ü—Ä–∏—á–∏–Ω–∞:** Backend –Ω–µ —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å frontend

**–†–µ—à–µ–Ω–∏–µ:**
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ `config/settings.py`:
```python
CORS_ALLOWED_ORIGINS = [
    "http://localhost:3000",
]
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ backend

```bash
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ backend —Ä–∞–±–æ—Ç–∞–µ—Ç
curl http://localhost:8000/api/users/telegram_auth/

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: {"detail":"Method \"GET\" not allowed."}
# –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - endpoint –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–æ–ª—å–∫–æ POST
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–Ω–æ–ø–∫–∞ –ø–æ—è–≤–∏–ª–∞—Å—å

1. –û—Ç–∫—Ä–æ–π—Ç–µ `http://localhost:3000/login`
2. –ù–∞–π–¥–∏—Ç–µ —Å–∏–Ω—é—é –∫–Ω–æ–ø–∫—É —Å —Ç–µ–∫—Å—Ç–æ–º "Login with Telegram"
3. –ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∏ –Ω–µ—Ç - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏

### –®–∞–≥ 6: –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É

1. –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "Login with Telegram"
2. –î–æ–ª–∂–Ω–æ –æ—Ç–∫—Ä—ã—Ç—å—Å—è –æ–∫–Ω–æ Telegram
3. –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é

### –®–∞–≥ 7: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ callback

–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è:
```
[TelegramLoginButton] Telegram auth callback received: {id: ..., first_name: ...}
[TelegramLoginButton] Sending request to: http://localhost:8000/api/users/telegram_auth/
[TelegramLoginButton] Backend response: {access: ..., refresh: ..., user: ...}
[TelegramLoginButton] Tokens saved, calling onAuth callback
```

## üß™ –¢–µ—Å—Ç –±–µ–∑ –∫–Ω–æ–ø–∫–∏

–ï—Å–ª–∏ –∫–Ω–æ–ø–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ API –Ω–∞–ø—Ä—è–º—É—é:

```bash
# –°–æ–∑–¥–∞–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
curl -X POST http://localhost:8000/api/users/telegram_auth/ \
  -H "Content-Type: application/json" \
  -d '{
    "id": 123456789,
    "first_name": "Test",
    "username": "testuser",
    "auth_date": 1700000000,
    "hash": "test_hash"
  }'

# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –æ—à–∏–±–∫—É "–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ Telegram"
# –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - hash –Ω–µ–≤–µ—Ä–Ω—ã–π
```

## üîß –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –¥–æ–º–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω

–û—Ç–∫—Ä–æ–π—Ç–µ [@BotFather](https://t.me/BotFather):
```
/mybots
@oko_expert_bot
Bot Settings
Domain
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `localhost`

### 2. –ï—Å–ª–∏ –¥–æ–º–µ–Ω –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

```
/setdomain
@oko_expert_bot
localhost
```

### 3. –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–æ–º–µ–Ω–∞:
1. –ó–∞–∫—Ä–æ–π—Ç–µ –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏ —Å `localhost:3000`
2. –û—Ç–∫—Ä–æ–π—Ç–µ –∑–∞–Ω–æ–≤–æ `http://localhost:3000/login`
3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞

## üì± –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ ngrok

–ï—Å–ª–∏ `localhost` –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ ngrok
# https://ngrok.com/download

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç—É–Ω–Ω–µ–ª—å
ngrok http 3000

# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ URL (–Ω–∞–ø—Ä–∏–º–µ—Ä: https://abc123.ngrok.io)

# –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≤ BotFather
/setdomain
@oko_expert_bot
abc123.ngrok.io

# –û—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
https://abc123.ngrok.io/login
```

## üÜò –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –ø–æ–º–æ–≥–∞–µ—Ç

### –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:

1. **Backend —Ä–∞–±–æ—Ç–∞–µ—Ç?**
```bash
docker-compose ps backend
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å: Up
```

2. **Frontend —Ä–∞–±–æ—Ç–∞–µ—Ç?**
```bash
docker-compose ps frontend
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å: Up
```

3. **–¢–æ–∫–µ–Ω –±–æ—Ç–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π?**
```bash
docker-compose exec backend python manage.py shell -c "
from django.conf import settings
print(settings.TELEGRAM_BOT_TOKEN)
"
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å: 8584999235:AAGKcP0nhnn_B6G8iTa2Ti8U9oxUFByWfpo
```

4. **Endpoint –¥–æ—Å—Ç—É–ø–µ–Ω?**
```bash
curl -X OPTIONS http://localhost:8000/api/users/telegram_auth/
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: 200 OK
```

## üìù –ß–µ–∫–ª–∏—Å—Ç

- [ ] –ö–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –æ—Ç–∫—Ä—ã—Ç–∞ (F12)
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏
- [ ] –î–æ–º–µ–Ω –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ BotFather (`localhost`)
- [ ] Backend –∑–∞–ø—É—â–µ–Ω (`docker-compose ps`)
- [ ] Frontend –∑–∞–ø—É—â–µ–Ω (`docker-compose ps`)
- [ ] –ö–Ω–æ–ø–∫–∞ –≤–∏–¥–Ω–∞ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
- [ ] –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è Telegram
- [ ] –ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ä–µ–¥–∏—Ä–µ–∫—Ç

## üí° –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ö–Ω–æ–ø–∫–∞ —Å–µ—Ä–∞—è –∏ –Ω–µ–∞–∫—Ç–∏–≤–Ω–∞

**–ü—Ä–∏—á–∏–Ω–∞:** –î–æ–º–µ–Ω –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –¥–æ–º–µ–Ω –≤ BotFather

### –ö–Ω–æ–ø–∫–∞ –µ—Å—Ç—å, –Ω–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∏—á–µ–≥–æ

**–ü—Ä–∏—á–∏–Ω–∞:** JavaScript –æ—à–∏–±–∫–∞

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞

### –û–∫–Ω–æ Telegram –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è, –Ω–æ –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –Ω–∏—á–µ–≥–æ

**–ü—Ä–∏—á–∏–Ω–∞:** Backend –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç –∏–ª–∏ CORS

**–†–µ—à–µ–Ω–∏–µ:** 
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ backend –ª–æ–≥–∏: `docker-compose logs backend`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

### –û—à–∏–±–∫–∞ "–ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏"

**–ü—Ä–∏—á–∏–Ω–∞:** –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –Ω–µ–≤–µ—Ä–Ω—ã–π –∏–ª–∏ –¥–∞–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω—ã

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞ –≤ `.env`

---

**–ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º–∞ –Ω–µ —Ä–µ—à–µ–Ω–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞!**
